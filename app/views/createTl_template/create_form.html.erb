<h1>Create a Tier List | Add Item Categories</h1>

<%= form_with url: create_field_path, method: :post, local: true do |form| %>
  <div>
    <%= form.label :the_name, "Tier List Name" %>
    <%= form.text_field :the_name, id: "name_field" %>
  </div>

  <h4>Columns already included for each item</h4>
  <ul>
    <li>Item name</li>
    <li>Item description</li>
  </ul>

  <div id="fields-container">
    <h4>Add additional fields for each item</h4>

    <!-- Initial Fields (Fields 1 to 5) -->
    <!-- Field 1 -->
    <div class="field">
      <fieldset>
        <legend><h3>Field 1</h3></legend>
        <div>
          <%= form.text_field :field1_name, placeholder: "Enter name", id: "field_1" %>
          <%= form.select :field1_datatype, [["Select Data Type", ""], ["Text", "Text"], ["Number", "Number"], ["Date", "Date"]], { selected: "" } %>
        </div>
      </fieldset>
    </div>

    <!-- Repeat similar structure for Fields 2 to 5 -->
    <div class="field">
      <fieldset>
        <legend><h3>Field 2</h3></legend>
        <div>
          <%= form.text_field :field2_name, placeholder: "Enter name", id: "field_2" %>
          <%= form.select :field2_datatype, [["Select Data Type", ""], ["Text", "Text"], ["Number", "Number"], ["Date", "Date"]], { selected: "" } %>
        </div>
      </fieldset>
    </div>

    <div class="field">
      <fieldset>
        <legend><h3>Field 3</h3></legend>
        <div>
          <%= form.text_field :field3_name, placeholder: "Enter name", id: "field_3" %>
          <%= form.select :field3_datatype, [["Select Data Type", ""], ["Text", "Text"], ["Number", "Number"], ["Date", "Date"]], { selected: "" } %>
        </div>
      </fieldset>
    </div>

    <div class="field">
      <fieldset>
        <legend><h3>Field 4</h3></legend>
        <div>
          <%= form.text_field :field4_name, placeholder: "Enter name", id: "field_4" %>
          <%= form.select :field4_datatype, [["Select Data Type", ""], ["Text", "Text"], ["Number", "Number"], ["Date", "Date"]], { selected: "" } %>
        </div>
      </fieldset>
    </div>

    <div class="field">
      <fieldset>
        <legend><h3>Field 5</h3></legend>
        <div>
          <%= form.text_field :field5_name, placeholder: "Enter name", id: "field_5" %>
          <%= form.select :field5_datatype, [["Select Data Type", ""], ["Text", "Text"], ["Number", "Number"], ["Date", "Date"]], { selected: "" } %>
        </div>
      </fieldset>
    </div>
  </div>

  <!-- Button to Add More Fields -->
  <button type="button" onclick="addField()">Add Another Field</button>    
  <p id="error-message" style="color: red;"></p>

  <!-- Submit Button -->
  <%= form.submit "Submit" %>
<% end %>

<script>
  let fieldCount = 6; // Initial count, assuming fields 1 to 5 exist

  function addField() {
    if (fieldCount > 10) {
      document.getElementById("error-message").textContent = "You can only add up to 10 fields.";
      return;
    }

    const fieldsContainer = document.getElementById('fields-container');
    const templateField = document.querySelector('.field');
    
    if (!templateField) {
      console.error("Template field with class 'field' not found.");
      return;
    }
    
    const newField = templateField.cloneNode(true);
    const legend = newField.querySelector('legend h3');
    legend.textContent = `Field ${fieldCount}`;

    const input = newField.querySelector('input[type="text"]');
    input.id = `field_${fieldCount}`;
    input.name = `field${fieldCount}_name`;
    input.placeholder = "Enter name";
    input.value = "";

    const select = newField.querySelector('select');
    select.name = `field${fieldCount}_datatype`;
    select.selectedIndex = 0;

    fieldsContainer.appendChild(newField);
    fieldCount++;
  }
</script>
